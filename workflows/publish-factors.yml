
    name: publish-factors

    on:
      workflow_dispatch:
      schedule:
        - cron: '5 13 * * 1-5'   # 13:05 UTC, weekdays

    permissions:
      contents: write
      id-token: write

    jobs:
      build:
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v4
            with:
              fetch-depth: 0

          - uses: actions/setup-python@v5
            with:
              python-version: '3.11'

          - name: Install deps
            run: |
              python -m pip install -U pip
              pip install requests pandas python-dateutil yfinance beautifulsoup4 lxml

          - name: Ensure packages
            run: mkdir -p fetchers pipelines tools models namm50 docs data/raw core

          - name: Fetch NAAIM (robust)
            run: |
              python -m fetchers.naaim || true

          - name: Compose factors_namm50.json (minimal)
            run: |
              python -m pipelines.compose_outputs


- name: Commit docs
  run: |
    git config user.name "github-actions[bot]"
    git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
    git fetch origin main
    git pull --rebase origin main
    git add docs/**/*.json || true
    git add docs/*.json || true
    git add docs/models/*.json || true
    git commit -m "Update docs [hotfix path/core] [skip ci]" || echo "no changes"
    git push origin HEAD:main

